"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.render = exports.parse = void 0;

var _lodash = _interopRequireDefault(require("lodash"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const props = [{
  type: 'children',
  check: (before, after, key) => _lodash.default.isObject(before[key]) && _lodash.default.isObject(after[key]),
  process: (before, after, fn) => ({
    children: fn(before, after)
  })
}, {
  type: 'added',
  check: (before, after, key) => !_lodash.default.has(before, key) && _lodash.default.has(after, key),
  process: (before, after) => ({
    value: after
  })
}, {
  type: 'deleted',
  check: (before, after, key) => _lodash.default.has(before, key) && !_lodash.default.has(after, key),
  process: before => ({
    value: before
  })
}, {
  type: 'unchanged',
  check: (before, after, key) => _lodash.default.has(before, key) && _lodash.default.has(after, key) && before[key] === after[key],
  process: before => ({
    value: before
  })
}, {
  type: 'changed',
  check: (before, after, key) => _lodash.default.has(before, key) && _lodash.default.has(after, key) && before[key] !== after[key],
  process: (before, after) => ({
    beforeValue: before,
    afterValue: after
  })
}];

const parse = (before, after) => {
  const configKeys = _lodash.default.keys({ ...before,
    ...after
  });

  const getProps = key => props.find(({
    check
  }) => check(before, after, key));

  return configKeys.map(key => {
    const {
      type,
      process
    } = getProps(key);
    const value = process(before[key], after[key], parse);
    return {
      key,
      type,
      ...value
    };
  });
};

exports.parse = parse;

const render = (ast, lvl = 0) => {
  const indent = tab => ' '.repeat(lvl + tab);

  const getString = (value, depth) => {
    if (!_lodash.default.isObject(value)) return value;
    return `{\n${indent(1)}${_lodash.default.keys(value).map(key => `${indent(1)}  ${key}: ${getString(value[key], depth)}`).join('\n')}\n${indent(1)}}`;
  };

  const renderString = {
    added: node => `${indent(1)} + ${node.key}: ${getString(node.value, lvl + 1)}`,
    deleted: node => `${indent(1)} - ${node.key}: ${getString(node.value, lvl + 1)}`,
    unchanged: node => `${indent(1)}   ${node.key}: ${getString(node.value, lvl + 1)}`,
    changed: node => `${indent(1)} + ${node.key}: ${getString(node.afterValue, lvl + 1)}\n${indent(2)} - ${node.key}: ${getString(node.beforeValue, lvl + 1)}`,
    children: node => `${indent(1)}${node.key}: ${render(node.children)}`
  };

  const renderResult = tree => tree.map(node => renderString[node.type](node)).join(`\n${indent(1)}`);

  return `{\n${indent(1)}${renderResult(ast)}\n${indent(0)}}`;
};

exports.render = render;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9nZW5EaWZmLmpzIl0sIm5hbWVzIjpbInByb3BzIiwidHlwZSIsImNoZWNrIiwiYmVmb3JlIiwiYWZ0ZXIiLCJrZXkiLCJfIiwiaXNPYmplY3QiLCJwcm9jZXNzIiwiZm4iLCJjaGlsZHJlbiIsImhhcyIsInZhbHVlIiwiYmVmb3JlVmFsdWUiLCJhZnRlclZhbHVlIiwicGFyc2UiLCJjb25maWdLZXlzIiwia2V5cyIsImdldFByb3BzIiwiZmluZCIsIm1hcCIsInJlbmRlciIsImFzdCIsImx2bCIsImluZGVudCIsInRhYiIsInJlcGVhdCIsImdldFN0cmluZyIsImRlcHRoIiwiam9pbiIsInJlbmRlclN0cmluZyIsImFkZGVkIiwibm9kZSIsImRlbGV0ZWQiLCJ1bmNoYW5nZWQiLCJjaGFuZ2VkIiwicmVuZGVyUmVzdWx0IiwidHJlZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOzs7O0FBRUEsTUFBTUEsS0FBSyxHQUFHLENBQ1o7QUFDRUMsRUFBQUEsSUFBSSxFQUFFLFVBRFI7QUFFRUMsRUFBQUEsS0FBSyxFQUFFLENBQUNDLE1BQUQsRUFBU0MsS0FBVCxFQUFnQkMsR0FBaEIsS0FBd0JDLGdCQUFFQyxRQUFGLENBQVdKLE1BQU0sQ0FBQ0UsR0FBRCxDQUFqQixLQUEyQkMsZ0JBQUVDLFFBQUYsQ0FBV0gsS0FBSyxDQUFDQyxHQUFELENBQWhCLENBRjVEO0FBR0VHLEVBQUFBLE9BQU8sRUFBRSxDQUFDTCxNQUFELEVBQVNDLEtBQVQsRUFBZ0JLLEVBQWhCLE1BQXdCO0FBQUVDLElBQUFBLFFBQVEsRUFBRUQsRUFBRSxDQUFDTixNQUFELEVBQVNDLEtBQVQ7QUFBZCxHQUF4QjtBQUhYLENBRFksRUFNWjtBQUNFSCxFQUFBQSxJQUFJLEVBQUUsT0FEUjtBQUVFQyxFQUFBQSxLQUFLLEVBQUUsQ0FBQ0MsTUFBRCxFQUFTQyxLQUFULEVBQWdCQyxHQUFoQixLQUF3QixDQUFDQyxnQkFBRUssR0FBRixDQUFNUixNQUFOLEVBQWNFLEdBQWQsQ0FB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QUVSLE1BQU0sQ0FBQyxDQUFELENBQUksTUFBS1EsSUFBSSxDQUFDM0IsR0FBSSxLQUFJc0IsU0FBUyxDQUFDSyxJQUFJLENBQUNsQixVQUFOLEVBQWtCUyxHQUFHLEdBQUcsQ0FBeEIsQ0FBMkIsS0FBSUMsTUFBTSxDQUM5RixDQUQ4RixDQUU5RixNQUFLUSxJQUFJLENBQUMzQixHQUFJLEtBQUlzQixTQUFTLENBQUNLLElBQUksQ0FBQ25CLFdBQU4sRUFBbUJVLEdBQUcsR0FBRyxDQUF6QixDQUE0QixFQU50QztBQU9uQmIsSUFBQUEsUUFBUSxFQUFHc0IsSUFBRCxJQUFXLEdBQUVSLE1BQU0sQ0FBQyxDQUFELENBQUksR0FBRVEsSUFBSSxDQUFDM0IsR0FBSSxLQUFJZ0IsTUFBTSxDQUFDVyxJQUFJLENBQUN0QixRQUFOLENBQWdCO0FBUG5ELEdBQXJCOztBQVVBLFFBQU0wQixZQUFZLEdBQUlDLElBQUQsSUFBVUEsSUFBSSxDQUFDakIsR0FBTCxDQUFVWSxJQUFELElBQVVGLFlBQVksQ0FBQ0UsSUFBSSxDQUFDL0IsSUFBTixDQUFaLENBQXdCK0IsSUFBeEIsQ0FBbkIsRUFBa0RILElBQWxELENBQXdELEtBQUlMLE1BQU0sQ0FBQyxDQUFELENBQUksRUFBdEUsQ0FBL0I7O0FBQ0EsU0FBUSxNQUFLQSxNQUFNLENBQUMsQ0FBRCxDQUFJLEdBQUVZLFlBQVksQ0FBQ2QsR0FBRCxDQUFNLEtBQUlFLE1BQU0sQ0FBQyxDQUFELENBQUksR0FBekQ7QUFDRCxDQXRCTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5cbmNvbnN0IHByb3BzID0gW1xuICB7XG4gICAgdHlwZTogJ2NoaWxkcmVuJyxcbiAgICBjaGVjazogKGJlZm9yZSwgYWZ0ZXIsIGtleSkgPT4gXy5pc09iamVjdChiZWZvcmVba2V5XSkgJiYgXy5pc09iamVjdChhZnRlcltrZXldKSxcbiAgICBwcm9jZXNzOiAoYmVmb3JlLCBhZnRlciwgZm4pID0+ICh7IGNoaWxkcmVuOiBmbihiZWZvcmUsIGFmdGVyKSB9KSxcbiAgfSxcbiAge1xuICAgIHR5cGU6ICdhZGRlZCcsXG4gICAgY2hlY2s6IChiZWZvcmUsIGFmdGVyLCBrZXkpID0+ICFfLmhhcyhiZWZvcmUsIGtleSkgJiYgXy5oYXMoYWZ0ZXIsIGtleSksXG4gICAgcHJvY2VzczogKGJlZm9yZSwgYWZ0ZXIpID0+ICh7IHZhbHVlOiBhZnRlciB9KSxcbiAgfSxcbiAge1xuICAgIHR5cGU6ICdkZWxldGVkJyxcbiAgICBjaGVjazogKGJlZm9yZSwgYWZ0ZXIsIGtleSkgPT4gXy5oYXMoYmVmb3JlLCBrZXkpICYmICFfLmhhcyhhZnRlciwga2V5KSxcbiAgICBwcm9jZXNzOiAoYmVmb3JlKSA9PiAoeyB2YWx1ZTogYmVmb3JlIH0pLFxuICB9LFxuICB7XG4gICAgdHlwZTogJ3VuY2hhbmdlZCcsXG4gICAgY2hlY2s6IChiZWZvcmUsIGFmdGVyLCBrZXkpID0+IF8uaGFzKGJlZm9yZSwga2V5KSAmJiBfLmhhcyhhZnRlciwga2V5KSAmJiBiZWZvcmVba2V5XSA9PT0gYWZ0ZXJba2V5XSxcbiAgICBwcm9jZXNzOiAoYmVmb3JlKSA9PiAoeyB2YWx1ZTogYmVmb3JlIH0pLFxuICB9LFxuICB7XG4gICAgdHlwZTogJ2NoYW5nZWQnLFxuICAgIGNoZWNrOiAoYmVmb3JlLCBhZnRlciwga2V5KSA9PiBfLmhhcyhiZWZvcmUsIGtleSkgJiYgXy5oYXMoYWZ0ZXIsIGtleSkgJiYgYmVmb3JlW2tleV0gIT09IGFmdGVyW2tleV0sXG4gICAgcHJvY2VzczogKGJlZm9yZSwgYWZ0ZXIpID0+ICh7IGJlZm9yZVZhbHVlOiBiZWZvcmUsIGFmdGVyVmFsdWU6IGFmdGVyIH0pLFxuICB9LFxuXTtcblxuZXhwb3J0IGNvbnN0IHBhcnNlID0gKGJlZm9yZSwgYWZ0ZXIpID0+IHtcbiAgY29uc3QgY29uZmlnS2V5cyA9IF8ua2V5cyh7IC4uLmJlZm9yZSwgLi4uYWZ0ZXIgfSk7XG4gIGNvbnN0IGdldFByb3BzID0gKGtleSkgPT4gcHJvcHMuZmluZCgoeyBjaGVjayB9KSA9PiBjaGVjayhiZWZvcmUsIGFmdGVyLCBrZXkpKTtcbiAgcmV0dXJuIGNvbmZpZ0tleXMubWFwKChrZXkpID0+IHtcbiAgICBjb25zdCB7IHR5cGUsIHByb2Nlc3MgfSA9IGdldFByb3BzKGtleSk7XG4gICAgY29uc3QgdmFsdWUgPSBwcm9jZXNzKGJlZm9yZVtrZXldLCBhZnRlcltrZXldLCBwYXJzZSk7XG4gICAgcmV0dXJuIHsga2V5LCB0eXBlLCAuLi52YWx1ZSB9O1xuICB9KTtcbn07XG5cbmV4cG9ydCBjb25zdCByZW5kZXIgPSAoYXN0LCBsdmwgPSAwKSA9PiB7XG4gIGNvbnN0IGluZGVudCA9ICh0YWIpID0+ICcgJy5yZXBlYXQobHZsICsgdGFiKTtcblxuICBjb25zdCBnZXRTdHJpbmcgPSAodmFsdWUsIGRlcHRoKSA9PiB7XG4gICAgaWYgKCFfLmlzT2JqZWN0KHZhbHVlKSkgcmV0dXJuIHZhbHVlO1xuICAgIHJldHVybiBge1xcbiR7aW5kZW50KDEpfSR7Xy5rZXlzKHZhbHVlKVxuICAgICAgLm1hcCgoa2V5KSA9PiBgJHtpbmRlbnQoMSl9ICAke2tleX06ICR7Z2V0U3RyaW5nKHZhbHVlW2tleV0sIGRlcHRoKX1gKVxuICAgICAgLmpvaW4oJ1xcbicpfVxcbiR7aW5kZW50KDEpfX1gO1xuICB9O1xuXG4gIGNvbnN0IHJlbmRlclN0cmluZyA9IHtcbiAgICBhZGRlZDogKG5vZGUpID0+IGAke2luZGVudCgxKX0gKyAke25vZGUua2V5fTogJHtnZXRTdHJpbmcobm9kZS52YWx1ZSwgbHZsICsgMSl9YCxcbiAgICBkZWxldGVkOiAobm9kZSkgPT4gYCR7aW5kZW50KDEpfSAtICR7bm9kZS5rZXl9OiAke2dldFN0cmluZyhub2RlLnZhbHVlLCBsdmwgKyAxKX1gLFxuICAgIHVuY2hhbmdlZDogKG5vZGUpID0+IGAke2luZGVudCgxKX0gICAke25vZGUua2V5fTogJHtnZXRTdHJpbmcobm9kZS52YWx1ZSwgbHZsICsgMSl9YCxcbiAgICBjaGFuZ2VkOiAobm9kZSkgPT4gYCR7aW5kZW50KDEpfSArICR7bm9kZS5rZXl9OiAke2dldFN0cmluZyhub2RlLmFmdGVyVmFsdWUsIGx2bCArIDEpfVxcbiR7aW5kZW50KFxuICAgICAgMixcbiAgICApfSAtICR7bm9kZS5rZXl9OiAke2dldFN0cmluZyhub2RlLmJlZm9yZVZhbHVlLCBsdmwgKyAxKX1gLFxuICAgIGNoaWxkcmVuOiAobm9kZSkgPT4gYCR7aW5kZW50KDEpfSR7bm9kZS5rZXl9OiAke3JlbmRlcihub2RlLmNoaWxkcmVuKX1gLFxuICB9O1xuXG4gIGNvbnN0IHJlbmRlclJlc3VsdCA9ICh0cmVlKSA9PiB0cmVlLm1hcCgobm9kZSkgPT4gcmVuZGVyU3RyaW5nW25vZGUudHlwZV0obm9kZSkpLmpvaW4oYFxcbiR7aW5kZW50KDEpfWApO1xuICByZXR1cm4gYHtcXG4ke2luZGVudCgxKX0ke3JlbmRlclJlc3VsdChhc3QpfVxcbiR7aW5kZW50KDApfX1gO1xufTtcbiJdfQ==